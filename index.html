<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>RaceChain — Neon Ferrari Metaverse</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: 'Orbitron', sans-serif;
  background: black;
  color: white;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: url('https://images.unsplash.com/photo-1549923746-c502d488b3ea?auto=format&fit=crop&w=1920&q=80') center/cover no-repeat;
  filter: brightness(0.25) blur(2px);
  z-index: -2;
}

canvas { display: block; z-index: 1; }

.overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
  text-align: center;
  background: radial-gradient(circle at 50% 60%, rgba(0,0,0,0.2), rgba(0,0,0,0.8));
  z-index: 10;
  transition: opacity 1.5s ease;
}

h1 {
  font-size: 3.6rem;
  letter-spacing: 6px;
  margin: 0;
  background: linear-gradient(90deg,#00f0ff,#9c4dff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 0 50px rgba(0,240,255,0.8);
  animation: titleGlow 3s infinite alternate;
}

@keyframes titleGlow {
  from { text-shadow: 0 0 30px rgba(0,240,255,0.4);}
  to { text-shadow: 0 0 80px rgba(156,77,255,0.9);}
}

p {
  opacity: 0.9;
  margin-top: 1rem;
  max-width: 550px;
  line-height: 1.5;
  font-size: 1.1rem;
}

button {
  margin-top: 2rem;
  background: linear-gradient(90deg,#00f0ff,#9c4dff);
  border: none;
  border-radius: 999px;
  padding: 14px 40px;
  color: #050018;
  font-weight: 700;
  font-size: 1.1rem;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 0 40px rgba(0,240,255,0.5);
}
button:hover {
  transform: scale(1.08);
  box-shadow: 0 0 80px rgba(156,77,255,0.8);
}
</style>
</head>

<body>
<canvas id="scene"></canvas>

<div class="overlay" id="overlay">
  <h1>RACE&nbsp;CHAIN</h1>
  <p>Enter the Neon Streets — Drive, Earn, and Compete in the Web3 Ferrari Metaverse.</p>
  <button id="startBtn">Connect Wallet to Start</button>
</div>

<audio id="engine" preload="auto" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_39f4b45c6f.mp3?filename=car-engine-18138.mp3" type="audio/mpeg" />
</audio>

<script>
// === 3D SCENE ===
const canvas = document.querySelector('#scene');
const renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.outputEncoding = THREE.sRGBEncoding;

const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000010, 0.025);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 500);
camera.position.set(0, 3, 10);

// === LIGHTS ===
const hemi = new THREE.HemisphereLight(0x00f0ff, 0x000022, 0.9);
const ambient = new THREE.AmbientLight(0x9c4dff, 0.5);
const point = new THREE.PointLight(0xffffff, 1.5, 60);
point.position.set(0, 8, 10);
scene.add(hemi, ambient, point);

// === ROAD ===
const groundGeo = new THREE.PlaneGeometry(300, 600);
const groundMat = new THREE.MeshStandardMaterial({
  color: 0x050011,
  metalness: 1,
  roughness: 0.25,
  emissive: 0x001144,
  emissiveIntensity: 1.3
});
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

// === NEON LIGHTS ===
for(let i=0; i<70; i++) {
  const h = Math.random()*5 + 3;
  const neon = new THREE.Mesh(
    new THREE.CylinderGeometry(0.1,0.1,h,8),
    new THREE.MeshStandardMaterial({
      emissive: new THREE.Color(`hsl(${Math.random()*360},100%,60%)`),
      emissiveIntensity: 2,
      metalness: 1
    })
  );
  neon.position.set((Math.random()-0.5)*80, h/2, (Math.random()-0.5)*200);
  scene.add(neon);
}

// === FERRARIS ===
const loader = new THREE.GLTFLoader();
const ferrariURL = "https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Ferrari/scene.gltf";
let ferraris = [];

function spawnFerrari(x, color) {
  loader.load(ferrariURL, gltf => {
    const car = gltf.scene;
    car.scale.set(0.012, 0.012, 0.012);
    car.position.set(x, 0, Math.random() * -80);
    car.traverse(obj => {
      if (obj.isMesh) {
        obj.material.emissive = new THREE.Color(color);
        obj.material.emissiveIntensity = 1.5;
      }
    });
    scene.add(car);
    ferraris.push({ mesh: car, speed: 0.8 + Math.random() * 0.3 });
  });
}

spawnFerrari(-2, 0xff1111);
spawnFerrari(2, 0x00f0ff);

// === BLOOM ===
const composer = new THREE.EffectComposer(renderer);
composer.addPass(new THREE.RenderPass(scene, camera));
const bloomPass = new THREE.UnrealBloomPass(
  new THREE.Vector2(window.innerWidth, window.innerHeight),
  1.0, 0.4, 0.8
);
composer.addPass(bloomPass);

// === ANIMATION LOOP ===
function animate() {
  requestAnimationFrame(animate);
  ferraris.forEach(f => {
    f.mesh.position.z += f.speed;
    if (f.mesh.position.z > 60) f.mesh.position.z = -100;
  });
  camera.position.x = Math.sin(Date.now() * 0.0003) * 5;
  camera.lookAt(0, 1, 0);
  composer.render();
}
animate();

// === CONNECT WALLET ===
document.getElementById('startBtn').addEventListener('click', () => {
  const engine = document.getElementById('engine');
  engine.volume = 0.4;
  engine.play().catch(()=>console.warn("Audio blocked by browser"));
  const overlay = document.getElementById('overlay');
  const btn = document.getElementById('startBtn');
  btn.textContent = "✅ Wallet Connected — Race Loading...";
  btn.style.background = "linear-gradient(90deg,#00f0ff,#a6ff00)";
  setTimeout(()=> overlay.style.opacity = 0, 1500);
});

// === RESIZE ===
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
  composer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>